<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Compactador Binário Avançado</title>
<style>
    body { font-family: Arial; background: #f0f0f0; padding: 20px; }
    textarea { width: 100%; height: 100px; font-family: monospace; }
    button { margin: 10px 0; }
</style>
</head>
<body>
<h2>Compactador Binário Avançado (0A[...], 1B[...])</h2>
<textarea id="entrada" placeholder="Cole o binário aqui..."></textarea><br>
<button onclick="compactarAvancado()">Compactar</button>
<textarea id="compactado" placeholder="Compactado..."></textarea><br>
<button onclick="reconstruirAvancado()">Reconstruir</button>
<textarea id="reconstruido" placeholder="Reconstruído..."></textarea>

<script>
function numToLetra(n) {
    if (n < 10) return n.toString();
    return String.fromCharCode(55 + n); // 10->A, 11->B, ..., 35->Z
}
function letraToNum(l) {
    if (!isNaN(l)) return parseInt(l);
    return l.charCodeAt(0) - 55;
}

function compactarAvancado() {
    const bin = document.getElementById("entrada").value.trim();
    if (!bin) return;
    let grupos = [];
    let atual = bin[0];
    let cont = 1;
    for (let i = 1; i <= bin.length; i++) {
        if (bin[i] === atual) {
            cont++;
        } else {
            grupos.push({bit: atual, qtd: cont});
            atual = bin[i];
            cont = 1;
        }
    }
    // Agrupa iguais
    let mapa = {};
    grupos.forEach((g, idx) => {
        let chave = g.bit + numToLetra(g.qtd);
        if (!mapa[chave]) mapa[chave] = [];
        mapa[chave].push(idx);
    });
    let resultado = [];
    for (let chave in mapa) {
        if (mapa[chave].length > 1) {
            resultado.push(chave + '[' + mapa[chave].join(',') + ']');
        } else {
            resultado.push(chave + '[' + mapa[chave][0] + ']');
        }
    }
    document.getElementById("compactado").value = resultado.join(' ');
}

function reconstruirAvancado() {
    const comp = document.getElementById("compactado").value.trim();
    if (!comp) return;
    let grupos = comp.match(/([01][0-9A-Z])\[([0-9,]+)\]/g);
    if (!grupos) return;
    let posicoes = [];
    grupos.forEach(gr => {
        let m = gr.match(/([01])([0-9A-Z])\[([0-9,]+)\]/);
        if (!m) return;
        let bit = m[1];
        let qtd = letraToNum(m[2]);
        let indices = m[3].split(',').map(Number);
        indices.forEach(idx => {
            posicoes[idx] = bit.repeat(qtd);
        });
    });
    document.getElementById("reconstruido").value = posicoes.join('');
}
</script>
</body>
</html>
