<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Imagem → Binário</title>
<style>
    body { font-family: Arial; background: #f0f0f0; padding: 20px; }
    input, textarea, button { margin-top: 10px; }
    textarea { width: 100%; height: 200px; font-family: monospace; }
</style>
</head>
<body>

<h2>Converter Imagem para B inário (010101...)</h2>
<input type="file" id="inputImagem" accept="image/*"><br>
<textarea id="saida" placeholder="O binário aparecerá aqui..."></textarea><br>
<button onclick="separarGrupos()">Separar Grupos</button><br>
<textarea id="grupos" placeholder="Os grupos aparecerão aqui..."></textarea><br>
<button onclick="compactarGrupos()">Compactar Grupos</button><br>
<textarea id="compactado" placeholder="O resultado compactado aparecerá aqui..."></textarea><br>
<button onclick="agruparCompactados()">Agrupar Iguais</button><br>
<textarea id="agrupado" placeholder="O agrupamento aparecerá aqui..."></textarea><br>
<button onclick="reconstruir()">Reconstruir Binário</button><br>
<textarea id="reconstruido" placeholder="O binário reconstruído aparecerá aqui..."></textarea><br>
<button onclick="copiar()">Copiar Binário</button>

<script>
document.getElementById("inputImagem").addEventListener("change", function(e) {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function(event) {
        const arrayBuffer = event.target.result;
        const bytes = new Uint8Array(arrayBuffer);

        let binario = '';
        for (let i = 0; i < bytes.length; i++) {
            binario += bytes[i].toString(2).padStart(8, '0');
        }

        document.getElementById("saida").value = binario;
    };
    reader.readAsArrayBuffer(file);
});

function copiar() {
    const textarea = document.getElementById("saida");
    textarea.select();
    document.execCommand("copy");
    alert("Binário copiado!");
}

function separarGrupos() {
    const binario = document.getElementById("saida").value.trim();
    if (!binario) {
        document.getElementById("grupos").value = "Cole ou gere o binário primeiro.";
        return;
    }
    let grupos = [];
    let atual = '';
    for (let i = 0; i < binario.length; i++) {
        if (atual === '' || binario[i] === atual[0]) {
            atual += binario[i];
        } else {
            grupos.push(atual);
            atual = binario[i];
        }
    }
    if (atual !== '') grupos.push(atual);
    document.getElementById("grupos").value = grupos.join(', ');
    // Salva os grupos para uso posterior
    window._gruposSeparados = grupos;
}

function numToSuperLetra(n) {
    // 0-9: '0'-'9', 10-35: 'A'-'Z', 36-61: 'a'-'z', 62+: combinações tipo ZA, ZB, ..., YA, YB, ...
    if (n < 10) return n.toString();
    if (n < 36) return String.fromCharCode(55 + n); // 10->A, ..., 35->Z
    if (n < 62) return String.fromCharCode(61 + n); // 36->a, ..., 61->z
    // Para 62+, faz pares de letras: ZA, ZB, ..., YA, YB, ...
    let letras = [];
    n -= 10; // Começa a partir de A
    while (n >= 26) {
        letras.unshift(String.fromCharCode(65 + (n % 26)));
        n = Math.floor(n / 26) - 1;
    }
    letras.unshift(String.fromCharCode(65 + (n % 26)));
    return letras.join('');
}

function compactarGrupos() {
    let grupos = window._gruposSeparados;
    if (!grupos || grupos.length === 0) {
        // Tenta obter dos campos se não existir na memória
        const texto = document.getElementById("grupos").value.trim();
        if (!texto) {
            document.getElementById("compactado").value = "Separe os grupos primeiro.";
            return;
        }
        grupos = texto.split(',').map(g => g.trim()).filter(Boolean);
    }
    const compactados = grupos.map(g => g[0] + numToSuperLetra(g.length));
    document.getElementById("compactado").value = compactados.join(' ');
    window._compactados = compactados;
}

function agruparCompactados() {
    let compactados = window._compactados;
    if (!compactados || compactados.length === 0) {
        // Tenta obter dos campos se não existir na memória
        const texto = document.getElementById("compactado").value.trim();
        if (!texto) {
            document.getElementById("agrupado").value = "Compacte os grupos primeiro.";
            return;
        }
        compactados = texto.split(' ').map(g => g.trim()).filter(Boolean);
    }
    // Mapeia cada grupo para suas posições
    const mapa = {};
    compactados.forEach((g, idx) => {
        if (!mapa[g]) mapa[g] = [];
        mapa[g].push(idx);
    });
    // Monta o resultado conforme solicitado
    let resultado = [];
    for (const grupo in mapa) {
        if (mapa[grupo].length > 1) {
            resultado.push(grupo + mapa[grupo].map(i => i).join(''));
        } else {
            resultado.push(grupo);
        }
    }
    document.getElementById("agrupado").value = resultado.join(' ');
    window._agrupado = resultado;
}

function reconstruir() {
    let agrupado = window._agrupado;
    if (!agrupado || agrupado.length === 0) {
        // Tenta obter do campo se não existir na memória
        const texto = document.getElementById("agrupado").value.trim();
        if (!texto) {
            document.getElementById("reconstruido").value = "Agrupe os grupos primeiro.";
            return;
        }
        agrupado = texto.split(' ').map(g => g.trim()).filter(Boolean);
    }
    // Cria um array para armazenar os grupos nas posições corretas
    let posicoes = [];
    agrupado.forEach(grupo => {
        // Se o grupo tem mais de 2 caracteres, há posições extras
        let valor = grupo[0];
        let qtd = parseInt(grupo[1]);
        let indices = [];
        if (grupo.length > 2) {
            indices = grupo.slice(2).split('').map(Number);
        } else {
            indices = [posicoes.length];
        }
        indices.forEach(idx => {
            posicoes[idx] = valor.repeat(qtd);
        });
    });
    // Junta os grupos na ordem
    const binario = posicoes.join('');
    document.getElementById("reconstruido").value = binario;
}
</script>

</script>

</body>
</html>
